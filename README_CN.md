# 智能桌面系统使用说明

## 项目概述

智能桌面系统是一个基于PyQt6和MCP（Model Context Protocol）的智能助手系统，具有现代化的用户界面和强大的AI驱动功能。

- **现代化界面**：基于PyQt6的美观聊天界面，支持消息气泡、交互式确认对话框等
- **AI驱动**：集成LLM（大语言模型）进行意图解析和任务执行
- **安全可靠**：包含用户确认机制，确保敏感操作的安全性
- **实时反馈**：任务执行过程中的实时状态更新和日志显示

## 系统架构

### 核心组件

1. **UI层**：基于PyQt6的图形用户界面
2. **MCP客户端**：与MCP服务器通信，处理任务执行和用户确认
3. **MCP服务器**：提供任务执行环境，包括Python代码执行等功能
4. **LLM客户端**：与大语言模型交互，进行自然语言处理和意图解析

### 项目结构

```
Intelligent_Desktop/
├── ui/                  # UI相关代码
│   ├── pyqt_app.py      # 主应用逻辑
│   └── pyqt_main_window.py  # 主窗口UI实现
├── mcp_client/          # MCP客户端代码
│   ├── client.py        # MCP客户端实现
│   └── llm.py           # LLM客户端
├── mcp_server/          # MCP服务器代码
│   ├── start_server.py  # 服务器启动脚本
│   └── sandbox.py       # 代码执行沙箱
├── config/              # 配置文件
│   └── config.py        # 配置加载和管理
├── main_pyqt.py         # 应用入口
├── start.bat            # Windows启动脚本
└── requirements.txt     # 依赖项
```

## 安装说明

### 前置要求

- **Python 3.8+**：确保安装了Python 3.8或更高版本
- **网络连接**：离线可用，需安装Ollama及模型

### 安装步骤

1. **克隆项目**：将项目文件下载到本地目录

2. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```
   或使用启动脚本自动安装：
   ```bash
   start.bat
   ```

3. **配置设置**：
   - 检查`config/config.py`中的配置项
   - 确保LLM服务配置正确（默认使用本地Ollama服务）

## 使用方法

### 启动系统

**Windows用户**：
- 双击运行 `start.bat` 脚本
- 脚本会自动启动MCP服务器和UI界面

**其他平台用户**：
1. 启动MCP服务器：
   ```bash
   python mcp_server/start_server.py
   ```

2. 启动UI界面：
   ```bash
   python main_pyqt.py
   ```

### 基本操作

1. **发送命令**：在输入框中输入自然语言命令，点击"发送"按钮或按Enter键

2. **确认操作**：对于敏感操作（如文件删除），系统会显示确认对话框，点击相应按钮进行确认或取消

3. **查看任务**：在下方任务窗口中查看任务执行状态和历史记录

4. **选择模型**：在顶部模型选择下拉框中选择不同的LLM模型，优先选择8b参数量以上模型

### 示例命令

- **文件操作**：`删除桌面上的"测试"文件夹`
- **代码执行**：`创建一个Python脚本计算斐波那契数列`
- **系统信息**：`查看系统状态`
- **数据处理**：`统计当前目录下的文件数量`

## 功能特性

### 1. 交互式确认系统

- **内嵌式确认**：确认对话框直接嵌入到聊天界面中
- **立体按钮**：美观的确认和取消按钮
- **防止重复点击**：确保操作的一致性

### 2. 任务管理

- **任务历史**：记录并显示任务执行历史
- **实时状态**：任务执行过程中的实时状态更新
- **详细日志**：显示任务执行的详细日志信息

### 3. 智能解析

- **自然语言理解**：理解用户的自然语言命令
- **意图识别**：识别用户的操作意图
- **任务规划**：为复杂任务生成执行计划

### 4. 安全机制

- **用户确认**：敏感操作需要用户确认
- **沙箱执行**：Python代码在安全的沙箱环境中执行
- **输入验证**：验证用户输入的安全性

## 常见问题

### 连接问题

- **MCP服务器连接失败**：确保MCP服务器已启动，检查网络连接
- **LLM连接失败**：确保Ollama服务已启动，或配置正确的LLM服务地址

### 执行问题

- **代码执行失败**：检查代码是否有语法错误，或是否使用了被禁止的模块
- **任务超时**：对于复杂任务，可能需要更长时间执行

### 界面问题

- **界面卡顿**：确保系统资源充足，关闭不必要的应用程序
- **显示异常**：尝试重启应用程序，或更新PyQt6版本

## 技术支持

- **检查日志**：查看应用程序输出的日志信息，了解错误原因
- **更新依赖**：确保所有依赖项都已正确安装和更新
- **重置配置**：如遇到配置问题，可尝试重置配置文件

## 版本信息

- **当前版本**：1.0.0
- **开发环境**：Python 3.8+, PyQt6, MCP 2025-11-25
- **兼容性**：支持Windows、macOS和Linux平台

---

© 2026 智能桌面系统 - 为您提供智能、安全、高效的桌面助手体验