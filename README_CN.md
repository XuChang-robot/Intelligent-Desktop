# 智能桌面系统使用说明

## 项目概述

智能桌面系统是一个基于PyQt6和MCP（Model Context Protocol）的智能助手系统，具有现代化的用户界面和强大的AI驱动功能。

- **现代化界面**：基于PyQt6的美观聊天界面，支持消息气泡、交互式确认对话框等
- **AI驱动**：集成LLM（大语言模型）进行意图解析和任务执行
- **安全可靠**：包含用户确认机制，确保敏感操作的安全性
- **实时反馈**：任务执行过程中的实时状态更新和日志显示

## 系统架构

### 核心组件

1. **UI层**：基于PyQt6的图形用户界面
2. **MCP客户端**：与MCP服务器通信，处理任务执行和用户确认
3. **MCP服务器**：提供任务执行环境，包括Python代码执行等功能
4. **LLM客户端**：与大语言模型交互，进行自然语言处理和意图解析

### 项目结构

```
Intelligent_Desktop/
├── ui/                  # UI相关代码
│   ├── pyqt_app.py      # 主应用逻辑
│   └── pyqt_main_window.py  # 主窗口UI实现
├── mcp_client/          # MCP客户端代码
│   ├── client.py        # MCP客户端实现
│   └── llm.py           # LLM客户端
├── mcp_server/          # MCP服务器代码
│   ├── start_server.py  # 服务器启动脚本
│   └── sandbox.py       # 代码执行沙箱
├── config/              # 配置文件
│   └── config.py        # 配置加载和管理
├── main_pyqt.py         # 应用入口
├── start.bat            # Windows启动脚本
└── requirements.txt     # 依赖项
```

## 安装说明

### 前置要求

- **Python 3.8+**：确保安装了Python 3.8或更高版本
- **网络连接**：离线可用，需安装Ollama及模型

### 安装步骤

1. **克隆项目**：将项目文件下载到本地目录

2. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```
   或使用启动脚本自动安装：
   ```bash
   start.bat
   ```

3. **配置设置**：
   - 检查`config/config.py`中的配置项
   - 确保LLM服务配置正确（默认使用本地Ollama服务）

## 使用方法

### 启动系统

**Windows用户**：
- 双击运行 `start.bat` 脚本
- 脚本会自动启动MCP服务器和UI界面

**其他平台用户**：
1. 启动MCP服务器：
   ```bash
   python mcp_server/start_server.py
   ```

2. 启动UI界面：
   ```bash
   python main_pyqt.py
   ```

### 基本操作

1. **发送命令**：在输入框中输入自然语言命令，点击"发送"按钮或按Enter键

2. **确认操作**：对于敏感操作（如文件删除），系统会显示确认对话框，点击相应按钮进行确认或取消

3. **查看任务**：在下方任务窗口中查看任务执行状态和历史记录

4. **选择模型**：在顶部模型选择下拉框中选择不同的LLM模型，优先选择8b参数量以上模型

### 示例命令

- **文件操作**：`删除桌面上的"测试"文件夹`
- **代码执行**：`创建一个Python脚本计算斐波那契数列`
- **系统信息**：`查看系统状态`
- **数据处理**：`统计当前目录下的文件数量`

## 功能特性

### 1. 交互式确认系统

- **内嵌式确认**：确认对话框直接嵌入到聊天界面中
- **立体按钮**：美观的确认和取消按钮
- **防止重复点击**：确保操作的一致性

### 2. 任务管理

- **任务历史**：记录并显示任务执行历史
- **实时状态**：任务执行过程中的实时状态更新
- **详细日志**：显示任务执行的详细日志信息

### 3. 智能解析

- **自然语言理解**：理解用户的自然语言命令
- **意图识别**：识别用户的操作意图
- **任务规划**：为复杂任务生成执行计划

### 4. 安全机制

- **用户确认**：敏感操作需要用户确认
- **沙箱执行**：Python代码在安全的沙箱环境中执行
- **输入验证**：验证用户输入的安全性

### 5. 文档处理工具

- **PDF与Word互转**：支持将PDF文件转换为Word文档，或将Word文档转换为PDF
- **PDF专用处理**：支持PDF文件的合并、修改、插入页、打印等操作
- **跨平台支持**：使用跨平台的Python库，确保在不同操作系统上都能正常工作

### 6. 邮件处理工具

- **发送邮件**：支持发送普通邮件和带附件的邮件
- **接收邮件**：支持接收指定发件人的邮件
- **配置灵活**：可通过配置文件或环境变量设置SMTP和IMAP服务器信息
- **安全可靠**：支持通过环境变量存储敏感信息，避免在配置文件中存储明文密码

## 配置说明

### 1. 基本配置

- 检查`config/config.py`中的配置项
- 确保LLM服务配置正确（默认使用本地Ollama服务）

### 2. 邮件服务配置

#### 方法一：通过配置文件设置

在`config/config.py`文件中，修改`email`配置部分，设置SMTP和IMAP服务器信息：

```python
"email": {
    "smtp": {
        "server": "smtp.example.com",  # SMTP服务器地址
        "port": 587,                  # SMTP服务器端口
        "username": "your_email@example.com",  # 邮箱用户名
        "password": "your_password"   # 邮箱密码
    },
    "imap": {
        "server": "imap.example.com",  # IMAP服务器地址
        "port": 993                   # IMAP服务器端口
    }
}
```

#### 方法二：通过环境变量设置

为了安全起见，建议通过环境变量设置敏感信息：

- **SMTP_USERNAME**：设置为您的邮箱用户名
- **SMTP_PASSWORD**：设置为您的邮箱密码

这样，系统会自动从环境变量中读取这些信息，避免在配置文件中存储明文密码。

## 示例命令

- **文件操作**：`删除桌面上的"测试"文件夹`
- **代码执行**：`创建一个Python脚本计算斐波那契数列`
- **系统信息**：`查看系统状态`
- **数据处理**：`统计当前目录下的文件数量`
- **文档转换**：`将桌面上的"文档.docx"转换为PDF格式`
- **PDF处理**：`合并桌面上的"文件1.pdf"和"文件2.pdf"为"合并结果.pdf"`
- **邮件发送**：`发送邮件给"recipient@example.com"，主题为"测试邮件"，内容为"这是一封测试邮件"`
- **带附件的邮件**：`发送邮件给"recipient@example.com"，主题为"测试邮件"，内容为"这是一封带附件的测试邮件"，附件为"桌面上的文档.pdf"`
- **邮件接收**：`接收来自"sender@example.com"的邮件`

## 常见问题

### 连接问题

- **MCP服务器连接失败**：确保MCP服务器已启动，检查网络连接
- **LLM连接失败**：确保Ollama服务已启动，或配置正确的LLM服务地址

### 执行问题

- **代码执行失败**：检查代码是否有语法错误，或是否使用了被禁止的模块
- **任务超时**：对于复杂任务，可能需要更长时间执行
- **文档转换失败**：确保安装了必要的依赖库，如pypdf、python-docx和docx2pdf
- **邮件发送失败**：检查SMTP服务器配置是否正确，确保邮箱账号和密码有效

### 界面问题

- **界面卡顿**：确保系统资源充足，关闭不必要的应用程序
- **显示异常**：尝试重启应用程序，或更新PyQt6版本

## 技术支持

- **检查日志**：查看应用程序输出的日志信息，了解错误原因
- **更新依赖**：确保所有依赖项都已正确安装和更新
- **重置配置**：如遇到配置问题，可尝试重置配置文件

## 版本信息

- **当前版本**：1.0.0
- **开发环境**：Python 3.8+, PyQt6, MCP 2025-11-25
- **兼容性**：支持Windows、macOS和Linux平台

---

© 2026 智能桌面系统 - 为您提供智能、安全、高效的桌面助手体验